<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Exoplanet Space Map</title>
    <style>
        body { margin: 0; overflow: hidden; }
        #info { position: absolute; top: 20px; left: 20px; color: white; }
    </style>
</head>
<body>
    <div id="info">Hover over a planet for details.</div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script>
        // Scene setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0x000000); // Set background color to black
        document.body.appendChild(renderer.domElement);

        // Create starry background
        const starsGeometry = new THREE.SphereGeometry(100, 100, 100);
        const starsMaterial = new THREE.MeshBasicMaterial({ color: 0xaaaaaa, side: THREE.BackSide });
        const stars = new THREE.Mesh(starsGeometry, starsMaterial);
        scene.add(stars);

        // Exoplanet data with positions and colors
        const exoplanets = [
            { name: 'Kepler-22b', position: [10, 0, 0], color: 0xff0000 },  // Red
            { name: 'Proxima Centauri b', position: [-15, 5, 0], color: 0x00ff00 },  // Green
            { name: 'HD 209458 b', position: [5, -10, 0], color: 0x0000ff },  // Blue
            { name: 'TRAPPIST-1e', position: [20, 10, -5], color: 0xffff00 },  // Yellow
            { name: 'LHS 1140 b', position: [-10, -5, 15], color: 0xff00ff }   // Magenta
        ];

        const planetSpheres = []; // Store planet spheres for rotation
        const modelPositions = exoplanets.map(planet => planet.position); // Store planet positions for the model path

        // Create planets as spheres and add to scene
        exoplanets.forEach(planet => {
            const geometry = new THREE.SphereGeometry(1, 32, 32); // Create a sphere geometry
            const material = new THREE.MeshPhongMaterial({ 
                color: planet.color,
                shininess: 100, // Adjust shininess for a bolder look
                specular: 0x555555 // Specular highlight color
            }); // Create a material with specified color
            const sphere = new THREE.Mesh(geometry, material); // Create a mesh with geometry and material
            sphere.position.set(...planet.position); // Set position
            sphere.userData = { name: planet.name }; // Store planet name in userData
            scene.add(sphere); // Add the sphere to the scene
            planetSpheres.push(sphere); // Store the sphere for rotation
        });

        // Add a light to illuminate the planets
        const ambientLight = new THREE.AmbientLight(0x404040); // Soft white light
        scene.add(ambientLight);
        
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1); // White directional light
        directionalLight.position.set(5, 5, 5).normalize();
        scene.add(directionalLight);

        // Load the spacecraft model
        const loader = new THREE.GLTFLoader();
        let spacecraft;
        
        loader.load('rocket/rkt.gltf', function(gltf) {
            spacecraft = gltf.scene;
            spacecraft.scale.set(0.5, 0.5, 0.5); // Scale the model if needed
            spacecraft.position.set(0, 0, 0); // Start at the origin
            scene.add(spacecraft);
            animate(); // Start the animation loop once the model is loaded
        }, undefined, function (error) {
            console.error(error);
        });

        // Camera position
        camera.position.z = 30;

        // Raycaster for hover effect
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        let targetPlanetPosition = null; // Store the target planet position

        function animate() {
            requestAnimationFrame(animate);

            // Rotate each planet on its axis
            planetSpheres.forEach(sphere => {
                sphere.rotation.y += 0.01; // Rotate the sphere around its Y-axis
            });

            // Move the spacecraft towards the target planet
            if (spacecraft && targetPlanetPosition) {
                const direction = targetPlanetPosition.clone().sub(spacecraft.position).normalize();
                spacecraft.position.add(direction.multiplyScalar(0.05)); // Move towards the target

                // Check if spacecraft reached the target position
                if (spacecraft.position.distanceTo(targetPlanetPosition) < 0.2) {
                    targetPlanetPosition = null; // Stop moving once we reach the target
                }
            }

            renderer.render(scene, camera);
        }

        // Mouse movement event
        window.addEventListener('mousemove', (event) => {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(scene.children);
            if (intersects.length > 0) {
                const planet = intersects[0].object.userData.name;
                const position = intersects[0].object.position.clone(); // Get the position as a Vector3
                const distance = calculateDistance(position.toArray());
                document.getElementById('info').textContent = `Planet: ${planet}, Distance: ${distance} units`;

                // Set target position for spacecraft to move to
                targetPlanetPosition = position;
            } else {
                // Reset info if not hovering over any planet
                document.getElementById('info').textContent = 'Hover over a planet for details.';
                targetPlanetPosition = null; // Stop moving if not hovering over a planet
            }
        });

        function calculateDistance(position) {
            const origin = new THREE.Vector3(0, 0, 0); // Origin point
            const planetPosition = new THREE.Vector3(...position); // Convert position array to Vector3
            return origin.distanceTo(planetPosition).toFixed(2); // Calculate distance and return fixed to 2 decimal places
        }

        // Resize handler
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>
